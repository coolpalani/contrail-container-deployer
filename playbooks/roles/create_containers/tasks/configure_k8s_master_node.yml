---
- name: initialize k8s master
  shell: | 
      kubeadm init --kubernetes-version v1.7.4 &&
      mkdir -p $HOME/.kube &&
      cp -u /etc/kubernetes/admin.conf $HOME/.kube/config &&
      chown -R $(id -u):$(id -g) $HOME/.kube
  when: inventory_hostname == master

- name: get master token
  shell: kubeadm token list |grep "The default bootstrap token generated by 'kubeadm init'." |awk '{print $1}'
  register: output
  when: inventory_hostname == master

- name: set master token
  set_fact:
    mastertoken: "{{ output.stdout }}"
  when: inventory_hostname == master

- name: enable kubelet service
  service:
    name: kubelet
    state: started
    enabled: yes
