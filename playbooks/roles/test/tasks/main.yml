---
- debug:
    msg: "{{ hostvars[item].ansible_hostname}}"
  with_items: "{{ groups['container_vms'] }}"

- debug:
    msg: "{{ hostvars[item].ansible_fqdn}}"
  with_items: "{{ groups['container_vms'] }}"

- name: ping 'em all
  shell: "ping -c 5 -q {{ hostvars[item].ansible_hostname}}"
  register: ping_result
  with_items: "{{ groups['container_vms'] }}"

- debug:
    #msg: "{{ ping_result.results[0].stdout_lines[3] }}"
    #msg: "{{ ping_result.results[0].stdout_lines[3] | regex_findall('\b(?:[0-9]{1,3}%)\b')}}"
    msg: "{{ ping_result.results[0].stdout_lines[3] | regex_findall('[0-9]{1,3}%')| regex_replace('%') |int }}"

- name: set ping success
  set_fact:
    ping_success: "{{ ping_result.results[0].stdout_lines[3] | regex_findall('[0-9]{1,3}%')| regex_replace('%') | int}}"

- debug:
    msg: "{{ ping_success }}"

- debug:
    msg: "ping is good"
  when: ping_success < 10

- debug:
    msg: "ping is bad"
  when: ping_success >= 10

- name: set master
  set_fact:
    master: "{{ groups['container_vms'][0] }}"

- name: get master
  include: get_master.yml

#- debug:
#    msg: "{{ hostvars[inventory_hostname] }}"
